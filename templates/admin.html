{% extends "base.html" %}

{% block title %}{{ _('Admin Panel') }}{% endblock %}

{% block content %}
<h1 style="text-align: center; font-family: 'Kaushan Script', cursive; margin-bottom: 20px;">{{ _('–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è') }}</h1>

<!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
<form id="filter-form" style="display: flex; gap: 15px; margin-bottom: 20px; align-items: center;">
    <select id="filter-type" class="input-box styled-dropdown" style="flex: 1;">
        <option value="">{{ _('–í—Å–µ —Ç–∏–ø—ã') }}</option>
        <option value="–ö–∞—Ä—Ç—Ä–∏–¥–∂ Canon 737">{{ _('–ö–∞—Ä—Ç—Ä–∏–¥–∂ Canon 737') }}</option>
        <option value="HDMI —Å–ø–ª–∏—Ç–µ—Ä 4-1 —Å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º">{{ _('HDMI —Å–ø–ª–∏—Ç–µ—Ä 4-1 —Å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º') }}</option>
        <option value="SSD Kingston SA400S37 480 Gb">{{ _('SSD Kingston SA400S37 480 Gb') }}</option>
        <option value="USB Flash –∫–∞—Ä—Ç–∞ Kingston DTXM/256 GB">{{ _('USB Flash –∫–∞—Ä—Ç–∞ Kingston DTXM/256 GB') }}</option>
        <option value="–ú—ã—à—å –ø—Ä–æ–≤–æ–¥–Ω–∞—è Logitech B100">{{ _('–ú—ã—à—å –ø—Ä–æ–≤–æ–¥–Ω–∞—è Logitech B100') }}</option>
        <option value="–ú–æ–Ω–∏—Ç–æ—Ä Samsung 24">{{ _('–ú–æ–Ω–∏—Ç–æ—Ä Samsung 24"') }}</option>
        <option value="–í–µ–±-–∫–∞–º–µ—Ä–∞ Logitech C270">{{ _('–í–µ–±-–∫–∞–º–µ—Ä–∞ Logitech C270') }}</option>
        <option value="–ù–∞—É—à–Ω–∏–∫–∏ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–º Defender">{{ _('–ù–∞—É—à–Ω–∏–∫–∏ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–º Defender') }}</option>
        <option value="–ü—Ä–æ–µ–∫—Ç–æ—Ä ViewSonic">{{ _('–ü—Ä–æ–µ–∫—Ç–æ—Ä ViewSonic') }}</option>
        <option value="–ö–∞—Ä—Ç—Ä–∏–¥–∂ HP CF283A (83A)">{{ _('–ö–∞—Ä—Ç—Ä–∏–¥–∂ HP CF283A (83A)') }}</option>
        <option value="–ß–∏–ø –¥–ª—è –∫–∞—Ä—Ç—Ä–∏–¥–∂–∞ HP 83A">{{ _('–ß–∏–ø –¥–ª—è –∫–∞—Ä—Ç—Ä–∏–¥–∂–∞ HP 83A') }}</option>
        <option value="–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ Smartbuy ONE 101">{{ _('–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ Smartbuy ONE 101') }}</option>
        <option value="–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∑–∞—Ä—è–¥–∫–∞ –¥–ª—è –Ω–æ—É—Ç–±—É–∫–æ–≤">{{ _('–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∑–∞—Ä—è–¥–∫–∞ –¥–ª—è –Ω–æ—É—Ç–±—É–∫–æ–≤') }}</option>
        <option value="–ü—Ä–∏–Ω—Ç–µ—Ä Brother HL-L2365">{{ _('–ü—Ä–∏–Ω—Ç–µ—Ä Brother HL-L2365') }}</option>
        <option value="–°–µ—Ç–µ–≤–æ–π —Ñ–∏–ª—å—Ç—Ä 5 —Ä–æ–∑–µ—Ç–æ–∫">{{ _('–°–µ—Ç–µ–≤–æ–π —Ñ–∏–ª—å—Ç—Ä 5 —Ä–æ–∑–µ—Ç–æ–∫') }}</option>
        <option value="–ö–∞–±–µ–ª—å HDMI 1.5–º">{{ _('–ö–∞–±–µ–ª—å HDMI 1.5–º') }}</option>
        <option value="–ö–∞–±–µ–ª—å USB‚ÄìmicroUSB">{{ _('–ö–∞–±–µ–ª—å USB‚ÄìmicroUSB') }}</option>
        <option value="–ü–∞–ø–∫–∞ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ A4">{{ _('–ü–∞–ø–∫–∞ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ A4') }}</option>
        <option value="–ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è ATX 500W">{{ _('–ë–ª–æ–∫ –ø–∏—Ç–∞–Ω–∏—è ATX 500W') }}</option>
        <option value="–†–æ—É—Ç–µ—Ä TP-Link Archer C20">{{ _('–†–æ—É—Ç–µ—Ä TP-Link Archer C20') }}</option>
        <option value="–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ">{{ _('–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ') }}</option>
        <option value="–†–µ–º–æ–Ω—Ç">{{ _('–†–µ–º–æ–Ω—Ç') }}</option>
    </select>
    <select id="filter-status" class="input-box styled-dropdown" style="flex: 1;">
        <option value="">{{ _('–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã') }}</option>
        <option value="–æ–∂–∏–¥–∞–µ—Ç">{{ _('–û–∂–∏–¥–∞–µ—Ç') }}</option>
        <option value="—Å–¥–µ–ª–∞–Ω–æ">{{ _('–°–¥–µ–ª–∞–Ω–æ') }}</option>
        <option value="–æ—Ç–∫–ª–æ–Ω–µ–Ω–æ">{{ _('–û—Ç–∫–ª–æ–Ω–µ–Ω–æ') }}</option>
        <option value="–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ">{{ _('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ') }}</option>
    </select>
    <input id="filter-query" type="text" placeholder="{{ _('–ü–æ–∏—Å–∫...') }}" class="input-box styled-input" style="flex: 2;">
    <button type="button" id="apply-filters" class="btn styled-btn" style="width: 173px; height: 44px; font-size: 16px; border-radius: 8px;">{{ _('–ü—Ä–∏–º–µ–Ω–∏—Ç—å') }}</button>
</form>

<!-- –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ -->
<div class="scrollable-section" style="flex: 1; overflow-y: auto; padding-right: 10px;">
    <h2 style="margin-bottom: 20px; color: #333;">{{ _('–°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫') }}</h2>
    <div id="request-list" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; padding: 10px; max-height: 90vh; overflow-y: auto;">
        {% if zayavki %}
            {% for z in zayavki %}
            <div class="card {% if z.urgent %}urgent{% endif %}" 
                 data-type="{{ z.type }}" 
                 data-status="{{ z.status }}" 
                 data-description="{{ z.description | lower }}" 
                 data-username="{{ z.user.username | lower }}" 
                 data-fullname="{{ z.user.full_name | lower }}">
                <h3 style="color: #000;">{{ z.type }}</h3>
                <p style="color: #555;">{{ z.description }}</p>
                <p><strong>{{ _('–î–∞—Ç–∞:') }}</strong> <span style="color: #555;">{{ z.created_at.strftime('%d.%m.%Y %H:%M') }}</span></p>
                <p><strong>{{ _('–°—Ç–∞—Ç—É—Å:') }}</strong>
                    {% if z.status == '—Å–¥–µ–ª–∞–Ω–æ' %}
                    <span style="color: green;">{{ _('–°–¥–µ–ª–∞–Ω–æ') }} ‚úÖ</span>
                    {% elif z.status == '–æ–∂–∏–¥–∞–µ—Ç' %}
                    <span style="color: orange;">{{ _('–û–∂–∏–¥–∞–µ—Ç') }} üü°</span>
                    {% elif z.status == '–æ—Ç–∫–ª–æ–Ω–µ–Ω–æ' %}
                    <span style="color: red;">{{ _('–û—Ç–∫–ª–æ–Ω–µ–Ω–æ') }} üî¥</span>
                    {% else %}
                    <span style="color: gray;">{{ _('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ') }}</span>
                    {% endif %}
                </p>
                <p><strong>{{ _('–§–∞–∫—É–ª—å—Ç–µ—Ç:') }}</strong> <span style="color: #555;">{{ z.user.faculty }}</span></p>
                <p><strong>{{ _('–§–∞–π–ª:') }}</strong>
                    {% if z.file %}
                        <a href="{{ url_for('uploaded_file', filename=z.file) }}" target="_blank" style="color: #007bff;">{{ _('–°–∫–∞—á–∞—Ç—å') }}</a>
                    {% else %}
                        <span style="color: #555;">{{ _('–ù–µ—Ç —Ñ–∞–π–ª–∞') }}</span>
                    {% endif %}
                </p>
                <p><strong>{{ _('–ö—Ç–æ –æ—Å—Ç–∞–≤–∏–ª –∑–∞—è–≤–∫—É:') }}</strong> <span style="color: #555;">{{ z.user.username }}</span></p>
                <form method="POST" action="/update_status">
                    <input type="hidden" name="id" value="{{ z.id }}">
                    <div class="status-buttons" style="display: flex; gap: 10px; margin-top: 10px;">
                        <button name="action" value="—Å–¥–µ–ª–∞–Ω–æ" class="btn compact-btn" style="background: #1cc88a;">‚úî {{ _('–°–¥–µ–ª–∞–Ω–æ') }}</button>
                        <button name="action" value="–æ–∂–∏–¥–∞–µ—Ç" class="btn compact-btn" style="background: #f6c23e;">‚åõ {{ _('–û–∂–∏–¥–∞–Ω–∏–µ') }}</button>
                        <button name="action" value="–æ—Ç–∫–ª–æ–Ω–µ–Ω–æ" class="btn compact-btn" style="background: #e74a3b;">‚úñ {{ _('–û—Ç–∫–∞–∑') }}</button>
                        <button name="action" value="–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ" class="btn compact-btn" style="background: #858796;">? {{ _('–ù–µ—è—Å–Ω–æ') }}</button>
                    </div>
                </form>
                
                {% if z.comment %}
                <div class="comments-section" style="margin-top: 15px; max-height: 100px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);">
                    <p style="font-size: 14px; color: #555;">{{ z.comment }}</p>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <p style="text-align: center; color: #888; font-size: 18px;">üîç {{ _('–ó–∞—è–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.') }}</p>
        {% endif %}
    </div>
</div>

<script>
    document.getElementById('apply-filters').addEventListener('click', function () {
        const typeFilter = document.getElementById('filter-type').value.toLowerCase();
        const statusFilter = document.getElementById('filter-status').value.toLowerCase();
        const queryFilter = document.getElementById('filter-query').value.toLowerCase();

        const cards = document.querySelectorAll('.card');
        cards.forEach(card => {
            const cardType = card.getAttribute('data-type').toLowerCase();
            const cardStatus = card.getAttribute('data-status').toLowerCase();
            const cardDescription = card.getAttribute('data-description');
            const cardUsername = card.getAttribute('data-username');
            const cardFullname = card.getAttribute('data-fullname');

            if (
                (typeFilter === '' || cardType.includes(typeFilter)) &&
                (statusFilter === '' || cardStatus.includes(statusFilter)) &&
                (queryFilter === '' || cardDescription.includes(queryFilter) || cardUsername.includes(queryFilter) || cardFullname.includes(queryFilter))
            ) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}
